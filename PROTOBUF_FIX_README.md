# Виправлення проблеми з protobuf

## Проблема

Коли оновлюєте tt-metal submodule до нової версії, білд падає з помилкою:
```
error: This file was generated by an older version of protoc which is
error: incompatible with your Protocol Buffer headers. Please
error: regenerate this file with a newer version of protoc.
```

## Причина

Старі згенеровані protobuf файли (`.pb.h`, `.pb.cc`) залишаються в **source tree** і конфліктують з новими protobuf headers. Ці файли повинні бути тільки в build directory, але якимось чином потрапили в source tree (можливо з Docker volume або старого build).

## Рішення

### На локальному Mac:

```bash
# 1. Запустити скрипт очищення
./clean_generated_protos.sh

# 2. Перебілдити
rm -rf build
mkdir build
cd build
cmake -DBUILD_TT_WAVELET=ON ..
make -j$(nproc)
```

### На сервері / в Docker:

```bash
# 1. Видалити старі згенеровані файли з source tree
find /root/tt-wavelet/third-party/tt-metal -name "*.pb.h" -type f \
  -not -path "*/build/*" -not -path "*/.cpmcache/*" -delete

find /root/tt-wavelet/third-party/tt-metal -name "*.pb.cc" -type f \
  -not -path "*/build/*" -not -path "*/.cpmcache/*" -delete

# 2. Видалити build directory
rm -rf /root/tt-wavelet/build

# 3. Створити необхідні директорії для toolchain
mkdir -p /root/tt-wavelet/third-party/tt-metal/runtime/hw/toolchain/{wormhole,blackhole,grayskull}

# 4. Створити build і білдити
mkdir /root/tt-wavelet/build
cd /root/tt-wavelet/build
cmake -DBUILD_TT_WAVELET=ON ..
make -j$(nproc)
```

### Якщо використовуєте Docker volumes:

Якщо у вас Docker з volume мounts, переконайтеся що volume не містить старих згенерованих файлів:

```bash
# Зупинити контейнер
docker stop <container_name>

# Видалити volume (якщо можна)
docker volume rm <volume_name>

# Або зайти в контейнер і почистити вручну
docker exec -it <container_name> bash
find /root/tt-wavelet/third-party/tt-metal -name "*.pb.h" -delete
find /root/tt-wavelet/third-party/tt-metal -name "*.pb.cc" -delete
```

## Профілактика

Файл `.gitignore` тепер оновлено і включає:
```
*.pb.h
*.pb.cc
```

Це означає що згенеровані protobuf файли не будуть випадково закомічені в git.

## Чому це сталося?

1. `mesh_graph_descriptor.proto` файл знаходиться в `tt_metal/fabric/protobuf/`
2. CMake генерує `.pb.h` та `.pb.cc` файли в `build/tt_metal/fabric/protobuf/`
3. Але старі версії або якийсь script міг згенерувати їх в `tools/scaleout/protobuf/` в source tree
4. Коли компілятор бачить `#include "protobuf/mesh_graph_descriptor.pb.h"`, він знаходить спочатку старий файл з source tree
5. Цей старий файл несумісний з новими protobuf headers → build fails
